<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
 <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>

    <script type="text/javascript">
        var currentUrl = "";

        function handleOpenURL(url) {
            setTimeout(function () {
                alert("received url: " + url);
                currentUrl = url;


            }, 200);
        }

    </script>
   
    <meta charset="utf-8" />
    <title>Sprintboards</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="description" />
    <meta content="HeadSpin" name="author" />

    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="plugins/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
    <link href="plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="css/style-metro.css" rel="stylesheet" type="text/css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <link href="css/style-responsive.css" rel="stylesheet" type="text/css" />
    <link href="css/themes/default.css" rel="stylesheet" type="text/css" id="style_color" />
    <link href="plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />
    <link href="css/custom.css" rel="stylesheet" type="text/css" />

    <!-- END GLOBAL MANDATORY STYLES -->


    <link rel="shortcut icon" href="http://sprintboards.com/favicon.ico" />
    <link rel="apple-touch-icon" href="http://sprintboards.com/img/apple-touch-icon.png">
    <link rel="image_src" href="http://sprintboards.com/img/apple-touch-icon.png">

    

</head>

<body class="page-header-fixed page-full-width" id="sbmobilebody">

    <div class="header navbar navbar-inverse navbar-fixed-top" style="position: fixed;">
  
        <div style="height: 20px; background-color: #ffffff;"></div>

        <div class="navbar-inner">
            <div class="container-fluid">

                <a class="brand" href="index.html">
                    <img src="img/sblogosm.png" alt="Sprintboards logo" />
                </a>

                <!--<a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">
                    <img src="img/menu-toggler.png" alt="" />
                </a>-->

            </div>
        </div>

    </div>

    <div class="page-container" style="padding-top: 60px !important; background-color: #ffffff;">


        <div class="page-content" id="page-shell">



            <!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <div id="email-config" class="modal hide" data-keyboard="false" data-backdrop="static">
                <div class="modal-header">
                    <button data-dismiss="modal" class="close" type="button"></button>
                    <h3>Share this Sprintboard</h3>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <strong class="big" style="padding:0px;">Copy & Paste:</strong><br />

                        <input type="text" id="theurl" style="width:450px;" class="" style="background-color:White;" value="http://dev.sprintboards.com/share/53e8b2bd-8bdc-43dd-ac92-81369936867e" />

                    </div>

                    <div class="control-group">

                        <div class="controls">

                            <a href="http://dev.sprintboards.com/share/53e8b2bd-8bdc-43dd-ac92-81369936867e" target="_blank" class="big">Copy this link to the Sprintboard</a>

                        </div>

                    </div>

                </div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" type="button">OK</button>

                </div>
            </div>



            <!-- BEGIN PAGE CONTAINER-->
            <div class="container-fluid" id="page-itself" style="display:none;">

                <!-- BEGIN PAGE TITLE-->
                <!--@{
                if (Model.HasLogo)
                {-->
                <!--if logo show this-->
                <!--<div class="row-fluid">
                    <div class="span4">
                        <h3 class="page-title">
                            <img data-bind="attr: { src: LogoLoc() + '/getLogo/' + RefNo() }" alt=" logo" />
                        </h3>
                    </div>
                    <div class="span8">
                        <h3 class="page-title dlogo-title">
                            <span class="pull-right"><span data-bind="text: Name"></span><p><small class="pull-right dlogo-small">Today</small></p></span>

                        </h3>
                    </div>
                </div>-->
                <!--end if logo-->
                <!--}
                else
                {-->

                <div class="row-fluid">
                    <div class="span12">
                        <h3 class="page-title">
                            <span data-bind="text: Name"></span>

                            <span class="pull-right" style="font-size:22px">Today</span>
                        </h3>
                    </div>
                </div>

                <!--}
                }-->
                <!-- END PAGE TITLE-->
                <!-- BEGIN PROJECT OVERVIEW & STATUS UPDATE-->
                <div class="row-fluid">


                    <div data-desktop="span6" data-tablet="span6" class="responsive span6">
                        <div class="dashboard-stat blue" style="">
                            <div class="details" style="float:left; margin-left:20px">
                                <div class="number" style="text-align:left;margin-bottom:20px">Project Overview</div>

                                <span class="hidden-phone"><div class="scroller desc" data-height="150px" style="text-align:left;margin-bottom:20px" data-bind="html: Notes"></div></span>
                                <span class="visible-phone"><div class="desc" style="text-align:left;margin-bottom:20px" data-bind="html: Notes"></div></span>


                            </div>
                            <span class="more">&nbsp;</span>
                        </div>
                    </div>







                    <div data-desktop="span6" data-tablet="span6" class="responsive span6">
                        <div style="" class="dashboard-stat blue">

                            <div style="float:left; margin-left:20px" class="details ">
                                <div class="number" style="text-align:left;margin-bottom:20px">Status Update </div>

                                <span class="hidden-phone"><div class="scroller desc" data-height="150px" style="text-align:left;margin-bottom:20px" data-bind="html: Update"></div></span>
                                <span class="visible-phone"><div class="desc" style="text-align:left;margin-bottom:20px" data-bind="html: Update"></div></span>


                            </div>
                            <span class="more">&nbsp;</span>
                        </div>
                    </div>



                </div>
                <!-- END PROJECT OVERVIEW & STATUS UPDATE-->
                <!-- BEGIN ANALYTICS ROW-->
                <div class="row-fluid">


                    <div data-desktop="span3" data-tablet="span3" class="responsive span3">

                        <div class="dashboard-stat darkblue">

                            <div class="visual">
                                <i class="icon-ok" data-bind="css: { 'icon-ok': Status() == 'On Track', 'icon-warning-sign': Status() == 'Warning', 'icon-remove': Status() == 'Off Track' }"></i>
                            </div>
                            <div class="details" style="width:137px">
                                <div class="number" data-bind="text: Status"></div>
                                <div class="desc">As of <span data-bind="text: moment(LastChangeDate()).format('ll')"></span></div>
                            </div>
                            <span class="more">&nbsp;</span>
                        </div>
                    </div>



                    <div data-desktop="span3" data-tablet="span3" class="responsive span3">
                        <div class="dashboard-stat darkblue">
                            <div class="visual">
                                <i class="icon-dashboard"></i>
                            </div>
                            <div class="details" style="width:137px">
                                <div class="number"><span data-bind="text: CalcCompletePercent"></span>%</div>
                                <div class="desc">Percent Complete</div>
                            </div>
                            <span class="more">&nbsp;</span>
                        </div>
                    </div>


                    <a href="#milestones">
                        <div data-desktop="span3" data-tablet="span3 " class="responsive span3">
                            <div class="dashboard-stat darkblue">
                                <div class="visual">
                                    <i class="icon-flag"></i>
                                </div>
                                <div class="details" style="width:137px">

                                    <div class="number"><span data-bind="text: RemainingMilestoneToCompleteCount"></span> of <span data-bind="text: MilestoneCount"></span></div>
                                    <div class="desc">Milestones To Do</div>



                                </div>
                                <a href="page2.html" class="more">
                                    next page <i class="m-icon-swapdown m-icon-white"></i>
                                </a>
                            </div>
                        </div>
                    </a>

                    <a href="#discussion">
                        <div data-desktop="span3" data-tablet="span3" class="responsive span3">
                            <div class="dashboard-stat darkblue">
                                <div class="visual">
                                    <i class="icon-comments"></i>
                                </div>
                                <div class="details" style="width:137px">
                                    <div class="number" data-bind="text: DiscussionCount"></div>
                                    <div class="desc">Discussion Items</div>
                                </div>
                                <a href="#discussion" class="more">
                                    View more <i class="m-icon-swapdown m-icon-white"></i>
                                </a>
                            </div>
                        </div>
                    </a>
                </div>
                <!-- END ANALYTICS ROW-->
                <!-- ko foreach: MilestoneBlocks -->
                <div id="milestones" class="row-fluid">

                    <div class="span12">
                        <!-- BEGIN SAMPLE TABLE PORTLET-->
                        <div class="portlet box darkblue">
                            <div class="portlet-title" style="background-color:#336699;">
                                <h4 data-bind="text: Name"></h4>

                            </div>
                            <div style="padding:0px;" class="portlet-body">

                                <ul class="events" data-bind="foreach: Tasks">

                                    <li>
                                        <span data-bind="html: formattedDate">
                                        </span>
                                        <span class="event-description">
                                            <h4 data-bind="text: Name"></h4>
                                            <p data-bind="html: Notes"></p>
                                        </span>
                                        <span data-bind="visible: IsComplete" class="ribbon tiny"><span class="ribbon-inner green-gradient">Done</span></span>
                                    </li>
                                </ul>

                                <ul class="events" data-bind="visible: HasTasks() == false">

                                    <li>

                                        <span class="event-description">
                                            <h4>No Milestones as of now.</h4>

                                        </span>

                                    </li>
                                </ul>

                            </div>
                        </div>
                        <!-- END SAMPLE TABLE PORTLET-->
                    </div>

                </div>
                <!-- /ko -->



                <div id="discussion" class="row-fluid" data-bind="with: DiscussionBlock, visible: DiscussionBlock ">
                    <div class="span12">
                        <!-- BEGIN SAMPLE TABLE PORTLET-->
                        <div class="portlet box darkblue">
                            <div class="portlet-title" style="background-color:#336699;">
                                <h4>Discussion Items</h4>

                            </div>
                            <div style="padding:0px;" class="portlet-body">


                                <ul class="events" data-bind="foreach: Tasks">

                                    <li>
                                        <span data-bind="html: formattedDate">
                                        </span>
                                        <span class="event-description">
                                            <h4 data-bind="text: Name"></h4>
                                            <p data-bind="html: Notes"></p>
                                        </span>
                                        <span data-bind="visible: IsComplete" class="ribbon tiny"><span class="ribbon-inner green-gradient">Done</span></span>
                                    </li>
                                </ul>

                                <ul class="events" data-bind="visible: HasTasks() == false">

                                    <li>

                                        <span class="event-description">
                                            <h4>No Discussion Items as of now.</h4>

                                        </span>

                                    </li>
                                </ul>


                            </div>
                        </div>
                        <!-- END SAMPLE TABLE PORTLET-->
                    </div>
                </div>






            </div>
            <!-- END PAGE CONTAINER-->
        </div>
        <!-- END PAGE -->
        <!--@{
        string shareurl = domain + "projects/share/" + Model.ProjectConfigId.ToString();
        string unlinkurl = domain + "projects/unlink/" + Model.ProjectConfigId.ToString();
        string unshareurl = domain + "projects/removeshare/" + Model.ProjectConfigId.ToString();
        http://dev.sprintboards.com/projects/share/1191
        http://dev.sprintboards.com/projects/unlink/1191
        http://dev.sprintboards.com/projects/removeshare//1191
        }-->

        <form action='http://dev.sprintboards.com/share/1191' id="share-form" method='post'></form>
        <form action='http://dev.sprintboards.com/projects/unlink/1191' id="unlink-form" method='post'></form>
        <form action='http://dev.sprintboards.com/projects/removeshare//1191' id="unshare-form" method='post'></form>


    </div>
    <!-- END CONTAINER -->
    <!--End DaBoard Partial-->
    <!--@section scripts{-->
    <!--End ShareBoard Partial-->
    <!-- BEGIN FOOTER -->
    <div class="footer">
        <div class="footer-inner">
            Today &copy; Sprintboards
        </div>
        <div class="footer-tools">
            <span class="go-top">
                <i class="icon-angle-up"></i>
            </span>
        </div>
    </div>
    <!-- END FOOTER -->
    <!-- BEGIN CORE PLUGINS -->
    <script src="plugins/jquery-1.10.1.min.js" type="text/javascript"></script>
    <script src="plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
    <!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
    <script src="plugins/jquery-ui/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
    <script src="plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="plugins/bootstrap-hover-dropdown/twitter-bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
    <!--[if lt IE 9]>
    <script src="/lib2/metro/assets/plugins/excanvas.min.js"></script>
    <script src="/lib2/metro/assets/plugins/respond.min.js"></script>
    <![endif]-->
    <script src="plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <script src="plugins/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="plugins/jquery.cookie.min.js" type="text/javascript"></script>
    <script src="plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
    <script src="scripts/app.js" type="text/javascript"></script>

    <script src="scripts/knockout-2.3.0.js" type="text/javascript"></script>
    <script src="scripts/knockout.mapping.2.4.1.js" type="text/javascript"></script>

    <script src="scripts/spin.min.js" type="text/javascript"></script>
    <script src="scripts/moment.min.js" type="text/javascript"></script>

    <script type="text/javascript">

       

        if (!currentUrl)
        {
            currentUrl = window.location.href;
        }

        var opts = {
            lines: 17,
            length: 40,
            width: 13,
            radius: 41,
            corners: 0,
            rotate: 38,
            trail: 45,
            speed: 2.0,
            direction: 1
        };

        var spinnerRooski = new Spinner(opts);
        spinnerRooski.spin(document.getElementById('page-shell'));

        jQuery(document).ready(function () {
            // initiate layout and plugins
            App.init();

            //@{
            //    string domain = System.Configuration.ConfigurationManager.AppSettings["domain"];
            //    string rr = this.Request.QueryString["r"];
            //    string url = domain + "share/GetSharedSprintboard/" + Model.ProjectConfigId.ToString() + "?r=" + rr;
            //http://dev.sprintboards.com/share/getsharedsprintboard/1191

            //      }

            function GetParameterValues(param) {
                var url = currentUrl.slice(currentUrl.indexOf('?') + 1).split('&');
                for (var i = 0; i < url.length; i++) {
                    var urlparam = url[i].split('=');
                    if (urlparam[0] == param) {
                        return urlparam[1];
                    }
                }
            }
                      
            
                    
            try {
                var viewModel = null;

                var sbId = GetParameterValues('sbid');
                
                var boards = [];

                //if (localStorage["boards"] == null)
                //{

                //}

                if (localStorage["boards"] != null)
                {
                    boards = JSON.parse(localStorage["boards"]);

                }

                var isIn = false;
                for (i = 0; i < boards.length; i++) {
                    if (boards[i] == sbId) {
                        isIn = true;
                    }

                }

                if (isIn == false) {
                    boards.push(sbId);
                }

                localStorage["boards"] = JSON.stringify(boards);

                if (!sbId) {
                    alert("url not formed correctly." + sbId);
                }

                console.log("localstorage", localStorage["boards"]);
              

                //alert(currentUrl);
                                              
                $.ajax({
                    url: "http://dev.sprintboards.com/share/getsharedsprintboard/" + sbId,
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        if (data.Ok) {
                            $('title').text('Sprintboards | ' + data.Board.Name);

                            viewModel = ko.mapping.fromJS(data.Board);

                            ko.applyBindings(viewModel);

                            spinnerRooski.stop();

                            $("#page-itself").show();
                        }
                        else {
                            spinnerRooski.stop();
                            //console.log(data);
                            alert(data.Msg);
                        }
                    }
                });

                if (!viewModel.HasDiffs()) {
                    $('#share-option').hide();
                }

            }
            catch (err) {

                spinnerRooski.stop();
                $("#page-itself").show();
                alert(err);
            }

            //setup the share link click
            $("#unlink, #share, #unshare").click(function () {
                var id = $(this).attr("id");

                if (id == "unlink") {
                    if (confirm("Are you sure you want to Remove this Sprintboard?")) {
                        var form = id + "-form";
                        $("#" + form).submit();
                    }
                }
                else if (id == "share") {
                    if (confirm("Are you sure you want to Publish this Sprintboard?")) {
                        var form = id + "-form";
                        $("#" + form).submit();
                    }
                }
                else if (id == "unshare") {
                    if (confirm("Are you sure you want to Unpublish this Sprintboard?")) {
                        var form = id + "-form";
                        $("#" + form).submit();
                    }
                }
                else {

                    var form = id + "-form";
                    $("#" + form).submit();
                }
                return false;
            });

            $("#theurl").click(function () {
                $(this).select();
            });

            // @if (ViewBag.ShowGetLinkPopup != null && (bool)ViewBag.ShowGetLinkPopup)
            //{
            //@:$("#email").click();
            //}
        });
    </script>

    <!-- END CORE PLUGINS -->

    <script type="text/javascript">
        (function ($) {
            $.fn.checkFileType = function (options) {
                var defaults = {
                    allowedExtensions: [],
                    success: function () { },
                    error: function () { }
                };
                options = $.extend(defaults, options);

                return this.each(function () {

                    $(this).on('change', function () {
                        var value = $(this).val();
                        var file = value.toLowerCase();

                        if (file != '') {
                            extension = file.substring(file.lastIndexOf('.') + 1);

                            if ($.inArray(extension, options.allowedExtensions) == -1) {
                                options.error();
                                $(this).focus();
                            } else {
                                options.success();
                            }
                        }
                    });

                });
            };

        })(jQuery);
    </script>
    <!--@RenderSection("scripts", false)-->
    <!-- END JAVASCRIPTS -->
</body>

<!-- END BODY -->
</html>